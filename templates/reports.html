{% extends "layout.html" %}

{% block title %}Relatórios - Livro Caixa{% endblock %}

{% block content %}
<header class="mb-8 flex justify-between items-center">
    <div>
        <h1 class="text-4xl font-bold text-gray-900">Relatórios de Entradas e Saídas</h1>
        <p class="text-gray-600">Visualize o desempenho financeiro por período.</p>
    </div>
    <div class="noprint flex gap-4">
        <a href="{{ url_for('detailed_report', start_date=start_date, end_date=end_date) }}" class="bg-purple-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-purple-700 transition duration-300">
            Relatório Detalhado
        </a>
        <button onclick="window.print()" class="bg-gray-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-gray-700 transition duration-300">
            Imprimir Relatório
        </button>
        <a href="{{ url_for('index') }}" class="bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-blue-700 transition duration-300">
            Voltar
        </a>
    </div>
</header>

<!-- Filtro de Período (não será impresso) -->
<section class="bg-white p-6 rounded-xl shadow-md mb-8 border border-gray-200 noprint">
    <form method="get" action="{{ url_for('reports') }}">
        <div class="flex flex-col md:flex-row items-center gap-4">
            <div>
                <label for="start_date" class="block text-sm font-medium text-gray-700">Data de Início</label>
                <input type="date" name="start_date" id="start_date" value="{{ start_date }}" class="mt-1 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div>
                <label for="end_date" class="block text-sm font-medium text-gray-700">Data de Fim</label>
                <input type="date" name="end_date" id="end_date" value="{{ end_date }}" class="mt-1 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="self-end">
                <button type="submit" class="bg-green-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-green-700 transition duration-300">Gerar Relatório</button>
            </div>
        </div>
    </form>
</section>

<!-- Resumo do Período -->
<section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div class="bg-white p-6 rounded-xl shadow-md border border-green-200">
        <h2 class="text-lg font-semibold text-gray-500 mb-2">Total de Entradas no Período</h2>
        <p class="text-3xl font-bold text-green-600">R$ {{ "%.2f"|format(total_income) }}</p>
    </div>
    <div class="bg-white p-6 rounded-xl shadow-md border border-red-200">
        <h2 class="text-lg font-semibold text-gray-500 mb-2">Total de Saídas no Período</h2>
        <p class="text-3xl font-bold text-red-600">R$ {{ "%.2f"|format(total_expense) }}</p>
    </div>
    <div class="bg-white p-6 rounded-xl shadow-md border border-blue-200">
        <h2 class="text-lg font-semibold text-gray-500 mb-2">Saldo do Período</h2>
        <p class="text-3xl font-bold {{ 'text-blue-600' if (total_income - total_expense) >= 0 else 'text-orange-600' }}">R$ {{ "%.2f"|format(total_income - total_expense) }}</p>
    </div>
</section>

<!-- Tabelas de Entradas e Saídas -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Tabela de Entradas -->
    <section class="bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden">
        <div class="p-6 bg-green-50">
            <h2 class="text-2xl font-bold text-green-800">Entradas (Receitas)</h2>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descrição</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for tx in income_transactions %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ tx.date.strftime('%d/%m/%Y') }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ tx.description }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-green-600">R$ {{ "%.2f"|format(tx.amount) }}</td>
                    </tr>
                    {% else %}
                    <tr><td colspan="3" class="px-6 py-12 text-center text-gray-500">Nenhuma entrada no período.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>

    <!-- Tabela de Saídas -->
    <section class="bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden">
        <div class="p-6 bg-red-50">
            <h2 class="text-2xl font-bold text-red-800">Saídas (Despesas)</h2>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descrição</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for tx in expense_transactions %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ tx.date.strftime('%d/%m/%Y') }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ tx.description }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-red-600">R$ {{ "%.2f"|format(tx.amount) }}</td>
                    </tr>
                    {% else %}
                    <tr><td colspan="3" class="px-6 py-12 text-center text-gray-500">Nenhuma saída no período.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
</div>
{% endblock %}
